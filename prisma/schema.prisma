generator client {
    provider = "prisma-client-js"
}

datasource db {
    provider = "mysql"
    url      = env("DATABASE_URL")
}

model Notebook  {
    //PK
    id                          Int             @id @default(autoincrement())
    //REQUIRED
    tag                         String          @unique
    //OPTIONAL
    description                 String?
    topics                      Topic[]       
    price                       Float?
    name                        String?
    questions                   Question[]
}

model Topic {
    //PK
    id                          Int             @id @default(autoincrement())
    //REQUIRED
    notebookId                  Int
    name                        String
    //OPTIONAL
    subtopics                   SubTopic[]
    //CONSTRAINTS
    notebook                    Notebook        @relation(fields: [notebookId], references: [id])    
}

model SubTopic {
    //PK
    id                          Int             @id @default(autoincrement())
    //REQUIRED
    notebookId                  Int
    tag                         String  
    topicId                     Int
    //OPTIONAL
    name                        String?
    questions                   Question[]
    //CONSTRAINTS
    topic                       Topic           @relation(fields: [topicId], references: [id])
    notebook                    Notebook        @relation(fields: [notebookId], references: [id])
    @@unique([notebookId, tag])
}

model Alternative {
    //PK
    id                          Int             @id @default(autoincrement())
    //REQUIRED
    alternative                 String
    questionId                  Int
    //CONSTRAINTS
    question                    Question        @relation(fields: [questionId], references: [id])
}

model Question {
    //PK
    id                          Int             @id @default(autoincrement())
    //REQUIRED
    notebookId                  Int
    tag                         String
    subTopicTag                 String
    question                    String
    questionFilename            String
    //OPTIONAL
    solution                    String?
    alternatives                Alternative[]
    alternativeRightId          Int?
    title                       String?
    //CONSTRAINTS
    notebook                    Notebook        @relation(fields: [notebookId], references: [id])
    alternativeRight            Alternative?    @relation(fields: [alternativeRightId], references: [id], "alternativeRight")
    subTopic                    SubTopic        @relation(fields: [notebookId, subTopicTag], references: [notebookId, tag]) 
    @@unique([notebookId, tag])
    @@unique([notebookId, questionFilename])
}